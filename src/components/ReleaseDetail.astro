---
import type { Release } from '../data/releases';
import { getReleaseLinkClass } from '../styles/release-link-classes';

interface Props {
  release: Release;
  variant?: 'featured' | 'standard';
  anchorId?: string;
}

const { release, variant = 'standard', anchorId }: Props = Astro.props;
const isFeatured = variant === 'featured';
const TitleTag = (isFeatured ? 'h3' : 'h2') as const;

const articleClass = isFeatured
  ? 'rounded-[2.5rem] border border-white/40 bg-white/80 p-6 shadow-[0_24px_60px_rgba(148,197,255,0.22)] backdrop-blur-xl transition-shadow duration-500 hover:shadow-[0_32px_84px_rgba(63,131,248,0.3)] sm:p-10'
  : 'rounded-[2.5rem] border border-white/40 bg-white/75 p-6 shadow-[0_24px_60px_rgba(148,197,255,0.24)] backdrop-blur-xl sm:p-10';

const infoWrapperClass = isFeatured
  ? 'flex flex-col justify-center space-y-4 text-center md:text-left'
  : 'flex flex-col justify-center space-y-4 text-center md:text-left';

const ctaWrapperClass = isFeatured
  ? 'flex flex-col gap-3 sm:flex-row sm:items-center'
  : 'flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center';

const fallbackDescription =
  '光の粒がきらめく夜景みたいに、シティポップの高揚感を閉じ込めた 1 曲。イヤフォンから広がる余韻を心ゆくまでどうぞ。';
---

<article
  id={anchorId}
  class={articleClass}
  data-animate={isFeatured ? 'scale-fade' : undefined}
  data-animate-distance={isFeatured ? '34px' : undefined}
  data-animate-duration={isFeatured ? '0.85s' : undefined}
>
  <div
    class="grid gap-8 md:grid-cols-[minmax(0,320px)_1fr] md:gap-12"
    data-animate-stagger={isFeatured ? '0.08s' : undefined}
  >
    <img
      src={release.cover}
      alt={release.title}
      class="mx-auto w-full max-w-xs rounded-[2rem] border border-primary/10 bg-white/80 p-4 shadow-lg sm:max-w-sm md:mx-0 md:max-w-none"
      loading="lazy"
      decoding="async"
      data-animate={isFeatured ? 'tilt-float' : undefined}
      data-animate-distance={isFeatured ? '26px' : undefined}
      data-animate-duration={isFeatured ? '0.9s' : undefined}
      data-animate-perspective={isFeatured ? '1100px' : undefined}
    />
    <div
      class={infoWrapperClass}
      data-animate={isFeatured ? 'fade-up' : undefined}
      data-animate-delay={isFeatured ? '0.08s' : undefined}
      data-animate-distance={isFeatured ? '26px' : undefined}
    >
      <div class="space-y-1.5">
        {!isFeatured && (
          <p class="text-xs uppercase tracking-[0.45em] text-primary sm:text-sm">{release.type}</p>
        )}
        <TitleTag
          class={`text-2xl font-bold font-heading text-text ${isFeatured ? 'sm:text-3xl' : 'sm:text-3xl'}`}
          data-animate={isFeatured ? 'fade-up' : undefined}
          data-animate-delay={isFeatured ? '0.12s' : undefined}
        >
          {release.title}
        </TitleTag>
        <p
          class={isFeatured ? 'text-base text-text/80 sm:text-lg' : 'text-base text-text/80 sm:text-lg'}
          data-animate={isFeatured ? 'fade-up' : undefined}
          data-animate-delay={isFeatured ? '0.16s' : undefined}
        >
          {release.year} {release.type}
        </p>
      </div>
      {release.tracks ? (
        <div
          class="rounded-3xl border border-primary/20 bg-white/70 p-4 text-left shadow-inner sm:p-6"
          data-animate={isFeatured ? 'fade-up' : undefined}
          data-animate-delay={isFeatured ? '0.22s' : undefined}
        >
          <p class="text-xs font-semibold uppercase tracking-[0.4em] text-primary/80 sm:text-sm">Tracklist</p>
          <ol
            class="mt-3 space-y-2 text-sm leading-relaxed text-text/85 sm:text-base"
            data-animate-stagger={isFeatured ? '0.06s' : undefined}
          >
            {release.tracks.map(track => (
              <li
                class="flex items-start gap-3"
                data-animate={isFeatured ? 'fade-up' : undefined}
                data-animate-distance={isFeatured ? '18px' : undefined}
              >
                <span class="min-w-[2ch] text-sm font-semibold text-primary/85 sm:text-base">
                  {String(track.no).padStart(2, '0')}
                </span>
                <span class="flex-1">{track.title}</span>
                {track.length && <span class="text-sm text-text/60">{track.length}</span>}
              </li>
            ))}
          </ol>
        </div>
      ) : (
        <p
          class="text-sm leading-relaxed text-text/75 sm:text-base"
          data-animate={isFeatured ? 'fade-up' : undefined}
          data-animate-delay={isFeatured ? '0.22s' : undefined}
        >
          {fallbackDescription}
        </p>
      )}
      <div
        class={ctaWrapperClass}
        data-animate-stagger={isFeatured ? '0.08s' : undefined}
      >
        {isFeatured ? (
          <>
            {release.links?.subscription && (
              <a
                href={release.links.subscription}
                target="_blank"
                rel="noopener noreferrer"
                class={`${getReleaseLinkClass('primary')} w-full px-6 py-3 text-base duration-300 sm:w-auto`}
                data-animate="fade-up"
                data-animate-delay="0.08s"
              >
                Streaming Links
              </a>
            )}
            {release.links?.youtube && (
              <a
                href={release.links.youtube}
                target="_blank"
                rel="noopener noreferrer"
                class={`${getReleaseLinkClass('secondary')} w-full px-6 py-3 text-base duration-300 sm:w-auto`}
                data-animate="fade-up"
              >
                Listen on YouTube
              </a>
            )}
          </>
        ) : (
          <>
            {release.links?.youtube && (
              <a
                href={release.links.youtube}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-pill btn-float focus-ring w-full bg-primary px-6 py-3 text-base text-white duration-300 hover:bg-primary/90 sm:w-auto"
              >
                Listen on YouTube
              </a>
            )}
            {release.links?.subscription && (
              <a
                href={release.links.subscription}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-pill btn-float focus-ring w-full border border-primary/30 px-6 py-3 text-base text-text duration-300 hover:border-primary/60 sm:w-auto"
              >
                Streaming Links
              </a>
            )}
          </>
        )}
      </div>
    </div>
  </div>
</article>
